{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:exams_exam_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; <a href="{% url 'admin:exams_exam_change' exam.id %}">{{ exam.name }}</a>
&rsaquo; Upload JSON
</div>
{% endblock %}

{% block content %}
<h1>Upload Questions JSON - {{ exam.name }}</h1>

<div style="margin: 20px 0; padding: 15px; background-color: #f0f0f0; border-left: 4px solid #417690;">
    <h3>Current Status</h3>
    <p><strong>Exam:</strong> {{ exam.name }}</p>
    <p><strong>Current Questions:</strong> {{ exam.questions.count }}</p>
    <p><strong>Exam Type:</strong> {{ exam.get_exam_type_display }}</p>
</div>

<div style="margin: 20px 0; padding: 15px; background-color: #fff3cd; border-left: 4px solid #ffc107;">
    <h3>JSON File Format</h3>
    <p>Your JSON file should be an array of question objects. Each question should have:</p>
    <pre style="background: #f5f5f5; padding: 10px; overflow-x: auto;">
[
  {
    "question_text": "What is AWS S3?",
    "domain": "S3",
    "difficulty": "easy",
    "explanation": "S3 is Amazon's object storage service.",
    "correct_answer_letter": "A",
    "options": [
      {"letter": "A", "text": "Object storage service"},
      {"letter": "B", "text": "Database service"},
      {"letter": "C", "text": "Compute service"},
      {"letter": "D", "text": "Networking service"}
    ]
  }
]</pre>
</div>

<form method="post" enctype="multipart/form-data" style="margin: 20px 0;">
    {% csrf_token %}
    
    <fieldset class="module aligned">
        <h2>Upload JSON File</h2>
        
        <div class="form-row">
            <div>
                <label for="id_json_file"><strong>JSON File:</strong></label>
                <input type="file" name="json_file" id="id_json_file" accept=".json" required style="margin-top: 5px;">
                <p class="help">Select a JSON file containing questions in the format shown above.</p>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="id_replace_existing">
                    <input type="checkbox" name="replace_existing" id="id_replace_existing" value="1">
                    <strong>Replace existing questions</strong>
                </label>
                <p class="help">If checked, all existing questions for this exam will be deleted before loading new ones.</p>
            </div>
        </div>
    </fieldset>
    
    <div class="submit-row">
        <input type="submit" value="Upload and Load Questions" class="default" style="padding: 10px 20px; font-size: 14px;">
        <a href="{% url 'admin:exams_exam_change' exam.id %}" class="button" style="padding: 10px 20px; margin-left: 10px;">Cancel</a>
    </div>
</form>

<div style="margin: 20px 0; padding: 15px; background-color: #d1ecf1; border-left: 4px solid #0c5460;">
    <h3>Tips</h3>
    <ul>
        <li>Questions with duplicate <code>question_text</code> will be skipped (unless replacing existing questions)</li>
        <li>Each question must have at least one option</li>
        <li>Maximum 4 options per question (additional options will be ignored)</li>
        <li>The <code>correct_answer_letter</code> must match one of the option letters</li>
        <li>If <code>difficulty</code> is not provided, it defaults to "medium"</li>
    </ul>
</div>
{% endblock %}












